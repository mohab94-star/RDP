name: Ubuntu RDP
on: workflow_dispatch

jobs:
  rdp-access:
    runs-on: ubuntu-latest
    steps:
      - name: Connect to Tailscale
        uses: tailscale/github-action@v2
        with:
          authkey: ${{ secrets.TAILSCALE_AUTHKEY }}

      - name: Install Desktop (Fast Mode)
        run: |
          sudo apt-get update
          # DEBIAN_FRONTEND=noninteractive prevents the installer from asking questions
          sudo DEBIAN_FRONTEND=noninteractive apt-get install -y xfce4 xrdp
          
          # Configure RDP for the 'runner' user
          echo "xfce4-session" > ~/.xsession
          echo "runner:YourSecurePassword123!" | sudo chpasswd
          
          sudo systemctl enable xrdp
          sudo systemctl restart xrdp
          echo "Ready! Find your IP in the Connect to Tailscale step above."

      - name: Wait for Connection
        run: sleep 3600
